local player = game.Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local workspace = game:GetService("Workspace")
local UIS = game:GetService("UserInputService")

-- UI Setup
local screenGui = Instance.new("ScreenGui", game.CoreGui)
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 250, 0, 100)
frame.Position = UDim2.new(0.5, -125, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(10, 10, 20)
frame.BorderSizePixel = 2
frame.Active = true
frame.Draggable = true

local uiGlow = Instance.new("UIStroke", frame)
uiGlow.Color = Color3.fromRGB(255, 0, 0)
uiGlow.Thickness = 3

local button = Instance.new("TextButton", frame)
button.Size = UDim2.new(1, 0, 0.5, 0)
button.Text = "ENABLE AUTO FARM"
button.BackgroundColor3 = Color3.fromRGB(50, 0, 50)
button.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Auto Farm State
local isFarmEnabled = false

-- Function to save the state of the script
local function saveState(state)
    local savedData = Instance.new("StringValue")
    savedData.Name = "AutoFarmState"
    savedData.Value = tostring(state)
    savedData.Parent = ReplicatedStorage
end

-- Load saved state
local function loadState()
    local savedData = ReplicatedStorage:FindFirstChild("AutoFarmState")
    if savedData then
        return savedData.Value == "true"
    end
    return false
end

-- Initial state
isFarmEnabled = loadState()

-- Update button text based on saved state
if isFarmEnabled then
    button.Text = "DISABLE AUTO FARM"
end

-- Function to teleport and kill the boss
local function teleportToBossAndKill()
    local boss = workspace:FindFirstChild("BadTimeTrioBoss")
    
    if boss then
        local bossHead = boss:FindFirstChild("Char") and boss.Char:FindFirstChild("Head")
        if bossHead then
            -- Teleport to the boss
            player.Character:SetPrimaryPartCFrame(bossHead.CFrame)

            -- Wait a bit before deleting the head (simulate the kill)
            wait(0.5)

            -- Delete the head to kill the boss
            pcall(function()
                bossHead:Destroy()
            end)
            print("Boss killed!")
        else
            print("No head part found for the boss!")
        end
    else
        print("Boss not found!")
    end
end

-- Function to start auto farm
local function startAutoFarm()
    while isFarmEnabled do
        teleportToBossAndKill()
        wait(1)  -- Delay between attempts
    end
end

-- Button click handler
button.MouseButton1Click:Connect(function()
    isFarmEnabled = not isFarmEnabled

    -- Toggle the button text based on the state
    if isFarmEnabled then
        button.Text = "DISABLE AUTO FARM"
        saveState(isFarmEnabled)
        startAutoFarm()  -- Start farming when enabled
    else
        button.Text = "ENABLE AUTO FARM"
        saveState(isFarmEnabled)
    end
end)

-- Ensure the script keeps track of the state after rejoining
if isFarmEnabled then
    startAutoFarm()
end
